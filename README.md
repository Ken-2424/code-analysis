# アンケートCSVユーザーID追加ツール

学籍番号ごとにユーザーID(1~18)を割り当て、ユーザー番号順にソートしたCSVファイルを生成するツールです。

## 📋 概要

このツールは以下の処理を行います:

1. CSVファイルから学籍番号を抽出
2. YAMLファイルで学籍番号とユーザーIDのマッピングを管理
3. ユーザー番号列を1列目に追加
4. ユーザーID順にソート
5. 新しいCSVファイルとして出力

## 🔧 前提条件

以下のソフトウェアがインストールされている必要があります:

- [Docker](https://www.docker.com/)
- [Docker Compose](https://docs.docker.com/compose/)

## 🚀 使い方

### ステップ1: YAMLテンプレートを生成

まず、学籍番号とユーザーIDのマッピングテンプレートを生成します:

```bash
chmod +x run.sh
./run.sh generate
```

実行すると、`config/user_mapping.yaml` ファイルが生成されます。
初期状態では学籍番号順に1~18のユーザーIDが仮設定されています。

### ステップ2: YAMLファイルを編集

`config/user_mapping.yaml` を開き、各学籍番号に割り当てるユーザーIDを編集します:

```yaml
# ユーザーIDマッピング設定ファイル
# 各学籍番号に対して1~18のユーザーIDを設定してください
# user_id: 1~18の範囲で一意な整数値を設定
# name: 参考情報(編集不要)

B25-3102:
  user_id: 1
  name: 大内美優
B25-3104:
  user_id: 2
  name: 金子朔空
B25-3105:
  user_id: 3
  name: 川合琳太郎
...
```

**編集のポイント:**
- `user_id` の値を1~18の範囲で設定
- すべてのユーザーIDは一意である必要があります(重複不可)
- `name` フィールドは参考情報なので編集不要

### ステップ3: ユーザーIDを追加してCSVを生成

YAMLファイルの編集が完了したら、以下のコマンドを実行:

```bash
./run.sh process
```

成功すると、`output/システムアンケート回答_ユーザー番号付き.csv` が生成されます。

## 📁 ファイル構成

```
.
├── Dockerfile                        # Docker環境定義
├── docker-compose.yml                # Dockerサービス設定
├── run.sh                            # 実行スクリプト
├── README.md                         # このファイル
├── システムアンケート回答.csv         # 元データ(入力)
├── scripts/
│   ├── generate_template.py         # テンプレート生成スクリプト
│   └── add_user_id.py               # ユーザーID追加スクリプト
├── config/
│   └── user_mapping.yaml            # ユーザーIDマッピング(編集対象)
└── output/
    └── システムアンケート回答_ユーザー番号付き.csv  # 出力ファイル
```

## 🛠 コマンド一覧

| コマンド | 説明 |
|---------|------|
| `./run.sh generate` | YAMLテンプレートを生成 |
| `./run.sh process` | ユーザーIDを追加してCSVを生成 |
| `./run.sh help` | ヘルプを表示 |

## ⚠️ エラー対処法

### エラー: user_idが設定されていません

YAMLファイルで `user_id: null` または未設定の学籍番号があります。
すべての学籍番号に1~18の値を設定してください。

### エラー: user_idは1~18の範囲である必要があります

ユーザーIDが範囲外です。1~18の整数を設定してください。

### エラー: user_idの重複が見つかりました

同じユーザーIDが複数の学籍番号に割り当てられています。
各ユーザーIDは一意である必要があります。

### エラー: ファイルが見つかりません

- `./run.sh generate` を実行する前に `システムアンケート回答.csv` が存在するか確認
- `./run.sh process` を実行する前に `config/user_mapping.yaml` が存在するか確認

## 📊 出力ファイルの形式

生成されるCSVファイルは以下の特徴があります:

1. **1列目**: ユーザー番号(1~18)
2. **2列目以降**: 元のCSVと同じ列(タイムスタンプ、氏名、学籍番号、...)
3. **ソート**: ユーザー番号の昇順

## 🔍 データ品質チェック

スクリプトは以下のチェックを自動的に実行します:

- ✅ 学籍番号の空白を自動削除
- ✅ ユーザーIDの範囲チェック(1~18)
- ✅ ユーザーIDの重複チェック
- ✅ すべての学籍番号がマッピングされているかチェック
- ✅ ユーザーIDの型チェック(整数のみ)

## 💡 ヒント

### YAMLファイルの再生成

YAMLファイルを初期状態に戻したい場合:

```bash
rm config/user_mapping.yaml
./run.sh generate
```

### 出力ファイルの確認

```bash
# ヘッダーと最初の5行を確認
head -n 6 output/システムアンケート回答_ユーザー番号付き.csv

# ユーザー番号の列のみ確認
cut -d',' -f1 output/システムアンケート回答_ユーザー番号付き.csv
```

## 📝 ライセンス

このプロジェクトは内部利用を目的としています。

## 🤝 サポート

問題が発生した場合は、エラーメッセージの内容を確認し、上記の「エラー対処法」を参照してください。
